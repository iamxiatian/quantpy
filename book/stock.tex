%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode
% !Mode:: "TeX:UTF-8"

\documentclass[a4paper,11pt, svgnames, oneside]{scrbook} %如果不加oneside，则奇偶页的边距会不同，以方便装订
\usepackage[a4paper, top=2cm, bottom=2cm, left=2cm, right=2cm]{geometry}
\usepackage{ulem}

\usepackage{xeCJK, fontspec, xunicode, xltxtra, fancybox, setspace,xcolor}
%\usepackage{ fontspec, xunicode, xltxtra, fancybox, setspace,xcolor}

\usepackage{amsmath, amsthm, amsfonts, amssymb, mathrsfs} %数学公式相关 amssymb用于斜体字符，如varnothing,  masthm用于定理, mathrsfs用于花体字母
\newtheorem{theorem}{\hskip 2em \cjkem 定理}[chapter]
\newtheorem{lemma}{\hskip 2em \cjkem 引理}[chapter]
\newtheorem{example}{\hskip 2em \cjkem 例} [chapter]
\renewcommand{\proofname}{\hskip 2em \cjkem 证明}
\usepackage[sort]{natbib}

\usepackage{caption, algorithm} %排版伪代码算法使用
\usepackage[]{algpseudocode}

\floatname{algorithm}{\cjkem{算法}}
\renewcommand{\algorithmicrequire}{\cjkem{输入:}} 
\renewcommand{\algorithmicensure}{\cjkem{输出:}}
\numberwithin{algorithm}{chapter}

\usepackage{colortbl, booktabs, multirow, makecell, longtable} %表格处理相关的Package

\usepackage{tikz, flowchart} % tikz绘图
\usepackage{pgfplots}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{calc, arrows, arrows.meta, shapes, shadows,  shapes.geometric, positioning}
\usetikzlibrary{topaths}
\usetikzlibrary{mindmap}
\usetikzlibrary{matrix}

\usepackage[tikz]{bclogo}  %see http://mirrors.ctan.org/graphics/bclogo/README
\DeclareGraphicsRule{.mps}{eps}{*}{} %解决xelatex处理bclogo时的mps问题
\newcommand{\infobox}[2]{ 
    \begin{bclogo}[couleur=yellow!10, logo=\bcfleur, ombre=true]{#1}
    #2
    \end{bclogo}
}
\newcommand{\warnbox}[2]{ 
    \begin{bclogo}[couleur=yellow!10, logo=\bctakecare, ombre=true]{#1}
    #2
    \end{bclogo}
}

\newcommand{\shellbox}[1]{ 
    \begin{bclogo}[couleur=gray!10, logo=\bccrayon, ombre=true]{命令}
    #1
    \end{bclogo}
}

%\usetikzlibrary{external} %cache tikz figure, run "xelatex -shell-escape smm.tex" to generate figures
%\tikzset{
%    external/system call={%
%    xelatex \tikzexternalcheckshellescape
%    -halt-on-error -interaction=batchmode --shell-escape
%    -jobname "\image" "\texsource"}}
%\tikzexternalize[prefix=generated/]
%\tikzexternalize[shell escape=-enable-write18]


%\setmainfont[Mapping=tex-text,LetterSpace=-1.25]{Neo Euler}
%\setsansfont[Mapping=tex-text,LetterSpace=-1.25]{}
%\setmonofont[Color=00663300]{Monaco}
\setCJKmainfont{FZLanTingHeiS-EL-GB} %方正字体，也可以改成：微软雅黑
\setCJKsansfont{FZLanTingHeiS-EL-GB} 
\setCJKmonofont{Ubuntu}

\usepackage{listings}
\lstset{breakatwhitespace,
columns=fullflexible,
keepspaces=false,
breaklines,
keywordstyle=\color{blue},
extendedchars=true}


\lstset{breakatwhitespace,
backgroundcolor=\color{white},
columns=fullflexible,
breaklines,
showtabs=true,
tabsize=4,
keepspaces=true,
keywordstyle=\color{blue},
extendedchars=true}


% Definition of JavaScript
\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}

\lstdefinelanguage{JavaScript}{
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
  keywordstyle=\color{blue}\bfseries,
  ndkeywords={class, export, boolean, throw, implements, import, this},
  ndkeywordstyle=\color{darkgray}\bfseries,
  identifierstyle=\color{black},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{purple}\ttfamily,
  stringstyle=\color{red}\ttfamily,
  morestring=[b]',
  morestring=[b]"
}

\lstset{
   language=JavaScript,
   %backgroundcolor=\color{lightgray},
   extendedchars=true,
   basicstyle=\footnotesize\ttfamily,
   showstringspaces=false,
   showspaces=false,
   numbers=left,
   numberstyle=\footnotesize,
   numbersep=9pt,
   tabsize=2,
   breaklines=true,
   showtabs=false,
   captionpos=t
}


\definecolor{orangered}{RGB}{239,134,64}
\definecolor{tagcolor}{RGB}{0,0,150}
\definecolor{keywordcolor}{RGB}{139,38,201}
\definecolor{attr_value_color}{RGB}{153,51,0}

\lstset{
    language=XML,
    tabsize=4,
    %caption=Code,
    label=code:sample,
    frame=shadowbox,
    rulesepcolor=\color{gray},
    xleftmargin=20pt,
    framexleftmargin=15pt,
    keywordstyle=\color{keywordcolor}\bf,
    commentstyle=\color{gray},
    stringstyle=\color{attr_value_color},    
    tagstyle=\color{tagcolor}\bf,
    markfirstintag=\color{red}\bf,
    numbers=left,
    numberstyle=\tiny,
    numbersep=5pt,
    breaklines=true,
    showstringspaces=false,
    basicstyle=\footnotesize,
    morekeywords={xmlns,version,type,encoding,xml-stylesheet, xs:schema,xs:element,xs:complexType,xs:sequence,xs:attribute}, % list your attributes here
    emphstyle={\color{blue}}}
\renewcommand{\lstlistingname}{Code}



\usepackage{indentfirst}  %首行缩进
\setlength{\parindent}{2em} 
\setlength{\listparindent}{2em} %item列表的段落缩进量

\usepackage{fancyhdr}
\thispagestyle{empty}

% 设置 plain style 的属性
\fancypagestyle{plain}{%
		\fancyhf{} % 清空当前设置

		% 设置页眉 (head)
		\fancyhead[RE]{\leftmark} % 在偶数页的右侧显示章名
		\fancyhead[LO]{\rightmark} % 在奇数页的左侧显示小节名
		\fancyhead[LE,RO]{~\thepage~} % 在偶数页的左侧，奇数页的右侧显示页码

		% 设置页脚：在每页的右下脚以斜体显示书名
		%\fancyfoot[RO,RE]{ {\it Written by Summer XIA}, Email: {\it xiat@ruc.edu.cn}}

		\renewcommand{\headrulewidth}{0.7pt} % 页眉与正文之间的水平线粗细
		\renewcommand{\footrulewidth}{0pt}
}

\pagestyle{fancy} % 选用 fancy style
% 其余同 plain style
\fancyhf{}
\fancyhead[RE]{\leftmark}
\fancyhead[LO]{\rightmark}
\fancyhead[LE,RO]{~\thepage~}
%\fancyfoot[RO,RE]{{\it Written by  Summer XIA}, Email: {\it xiat@ruc.edu.cn}}


%%%%%%%%%% 一些重定义 %%%%%%%%%%
\renewcommand{\contentsname}{目录}     % 将Contents改为目录
\renewcommand{\indexname}{索引}
\renewcommand{\figurename}{图}
\renewcommand{\tablename}{表}
\renewcommand{\appendixname}{附录}

\renewcommand{\bibname}{参考文献}
\let\oldbibliography\thebibliography
\renewcommand\thebibliography[1]{
	\oldbibliography{#1}
	\setlength{\parskip}{0pt}
	\setlength{\itemsep}{0pt plus 0.2ex}
}

\newcommand{\tab}{\phantom{o}\hspace{2ex}}


\usepackage{draftwatermark}
\SetWatermarkText{}%设置水印文字
\SetWatermarkLightness{0.9}%设置水印亮度
\SetWatermarkScale{0.5}%设置水印大小

\usepackage[bookmarks=true]{hyperref} %生成pdf索引
\usepackage{bookmark}

\usepackage{kpfonts}
\usepackage[bf, explicit]{titlesec} %对标题的式样进行设置
\newcommand*\chapterlabel{}
\titlespacing*{\chapter}{0pt}{50pt}{-60pt}
\renewcommand{\chaptername}{}
\titleformat{\section}[hang]{\color{MidnightBlue}\LARGE\bfseries}{\color{MidnightBlue}{\thesection}
}{.8em}{\thesection ~ #1}
\titleformat{\subsection}[hang]{\color{NavyBlue}\Large\bfseries}{\color{NavyBlue}{\thesubsection}
}{.8em}{\thesubsection ~ #1}
\titleformat{\subsubsection}[hang]{\large\bfseries}{\thesubsubsection}{.8em}{\hspace{1em}
  $\blacksquare$ \cjkem \thesubsubsection ~ #1}


%自定义的一些命令，方便使用
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
  \node[shape=circle,draw,inner sep=1.5pt] (char) {#1};}}


%\newcommand*{\hei}{\fontfamily{FZLanTingHeiS-H-GB}\selectfont}
%\DeclareTextFontCommand{\texthei}{\hei}

\setCJKfamilyfont{FZHei}{FZLanTingHeiS-R-GB}  
\newcommand{\cjkbold}{\color[rgb]{0.29, 0.0, 0.51} \CJKfamily{FZHei}}  %http://latexcolor.com/

\setCJKfamilyfont{FZHeiR}{FZLanTingHeiS-R-GB}  
\newcommand{\cjkem}{\CJKfamily{FZHeiR}} 

\begin{document}

    \frontmatter

    \include{cover}       % include title page
    \include{preface}       % include preface
    \include{content}       % include content

    %\include{other}         % include other frontmatter
  

    \mainmatter


			\titleformat{\chapter}
			  {\gdef\chapterlabel{}
			   \normalfont\sffamily\Huge\bfseries\scshape}
			  {\gdef\chapterlabel{\thechapter\ }}{0pt}
			  {
				\begin{tikzpicture}[remember picture,overlay]
				\node[yshift=-5cm] at (current page.north west)
				  {\begin{tikzpicture}[remember picture, overlay]
					\draw[fill=orange!20, draw=black, dotted] (0,0) rectangle
					  (\paperwidth,5cm);
					\node[scale=1.3, rounded corners=5pt, line width=2pt, dotted, draw=orange!80, minimum width=2cm, minimum height=2cm] at (3.5,2.5) {  \color{orange}~$\chapterlabel$ $\hookleftarrow$  };
					\node[anchor=east,xshift=.9\paperwidth,rectangle,
						  rounded corners=20pt,inner sep=11pt,draw,
						  fill=white, minimum width=7cm](name)
						  {  \color{black}  #1   };
				   \end{tikzpicture}
				  };
			   \end{tikzpicture}
				\vspace{4em}
			  }

     
%     \include{chapter/introduction}
     %\part{基础知识}
     \include{chapter/theory}
     \include{chapter/macd}

    \appendix
    %\include{history}       % include first appendix
    %\include{tables}        % include second appendix, etc.
    
    
	\backmatter

		\titleformat{\chapter}
		  {\gdef\chapterlabel{}
		   \normalfont\sffamily\Huge\bfseries\scshape}
		  {\gdef\chapterlabel{\thechapter\ }}{0pt}
		  {
			\begin{tikzpicture}[remember picture,overlay]
			\node[yshift=-4cm] at (current page.north west)
			  {\begin{tikzpicture}[remember picture, overlay]
				\draw[fill=LightSkyBlue!20, draw=black, dashed] (0,0) rectangle
				  (\paperwidth,4cm);
				\node[anchor=east,xshift=.9\paperwidth,rectangle,
					  rounded corners=20pt,inner sep=11pt,draw,
					  fill=white, minimum width=6cm](name)
					  {  {\chapterlabel} \color{black}  #1   };
			   \end{tikzpicture}
			  };
		   \end{tikzpicture}
			\vspace{2em}
		  }
	
	\bibliographystyle{plain}
	\bibliography{bibliography}
    %\include{chapter/bibliography}  % include bibliography
    %\include{index}         % include index
    \include{chapter/thanks}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
